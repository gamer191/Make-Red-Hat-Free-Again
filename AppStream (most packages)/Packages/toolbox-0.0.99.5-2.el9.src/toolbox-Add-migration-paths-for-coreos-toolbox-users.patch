From 4587b6e9240bf936b760e901435c4cfdd9c582b6 Mon Sep 17 00:00:00 2001
From: Debarshi Ray <rishi@fedoraproject.org>
Date: Wed, 18 Aug 2021 17:55:21 +0200
Subject: [PATCH 1/2] cmd/run: Make sosreport work by setting the HOST
 environment variable

https://bugzilla.redhat.com/show_bug.cgi?id=1940037
---
 src/cmd/run.go | 1 +
 1 file changed, 1 insertion(+)

diff --git a/src/cmd/run.go b/src/cmd/run.go
index e2e31d9da4e6..84ad46518bfc 100644
--- a/src/cmd/run.go
+++ b/src/cmd/run.go
@@ -498,6 +498,7 @@ func constructExecArgs(container, preserveFDs string,
 	execArgs = append(execArgs, envOptions...)
 
 	execArgs = append(execArgs, []string{
+		"--env", "HOST=/run/host",
 		"--interactive",
 		"--preserve-fds", preserveFDs,
 	}...)
-- 
2.43.0


From 892c33ed75443de90a2caa90959387bbc270c564 Mon Sep 17 00:00:00 2001
From: Debarshi Ray <rishi@fedoraproject.org>
Date: Fri, 10 Dec 2021 13:42:15 +0100
Subject: [PATCH 2/2] test/system: Update to test the migration path for
 coreos/toolbox users

This reverts the changes to the tests made in commit
411147988b730dabf8b9e761a5426e12d648f008 by restoring commit
ca899c8a561f357ae32c6ba6813520fd8b682abb and the parts of commit
3aeb7cf288319e35eb9c5e26ea18d97452462c1e that were removed.
---
 test/system/002-help.bats | 14 --------------
 test/system/100-root.bats | 27 +++++++++++++++++++++++++++
 2 files changed, 27 insertions(+), 14 deletions(-)
 create mode 100644 test/system/100-root.bats

diff --git a/test/system/002-help.bats b/test/system/002-help.bats
index 695c51f92e7e..5fa4c6fe0b4c 100644
--- a/test/system/002-help.bats
+++ b/test/system/002-help.bats
@@ -23,20 +23,6 @@ setup() {
   _setup_environment
 }
 
-@test "help: Smoke test" {
-  run --keep-empty-lines --separate-stderr "$TOOLBOX"
-
-  assert_failure
-  assert [ ${#lines[@]} -eq 0 ]
-  lines=("${stderr_lines[@]}")
-  assert_line --index 0 "Error: missing command"
-  assert_line --index 2 "create    Create a new toolbox container"
-  assert_line --index 3 "enter     Enter an existing toolbox container"
-  assert_line --index 4 "list      List all existing toolbox containers and images"
-  assert_line --index 6 "Run 'toolbox --help' for usage."
-  assert [ ${#stderr_lines[@]} -eq 7 ]
-}
-
 @test "help: Command 'help'" {
   if ! command -v man 2>/dev/null; then
     skip "not found man(1)"
diff --git a/test/system/100-root.bats b/test/system/100-root.bats
new file mode 100644
index 000000000000..32d87904213e
--- /dev/null
+++ b/test/system/100-root.bats
@@ -0,0 +1,27 @@
+#!/usr/bin/env bats
+
+load 'libs/bats-support/load'
+load 'libs/bats-assert/load'
+load 'libs/helpers'
+
+setup() {
+  _setup_environment
+  cleanup_containers
+}
+
+teardown() {
+  cleanup_containers
+}
+
+@test "root: Try to enter the default container with no containers created" {
+  run $TOOLBOX <<< "n"
+
+  assert_success
+  assert_line --index 0 "No toolbox containers found. Create now? [y/N] A container can be created later with the 'create' command."
+  assert_line --index 1 "Run 'toolbox --help' for usage."
+}
+
+# TODO: Write the test
+@test "root: Enter the default container when 1 non-default container is present" {
+  skip "Testing of entering toolboxes is not implemented"
+}
-- 
2.43.0

