From 059a3289bce7bf6bc363294a06eee8ad4ba46aa2 Mon Sep 17 00:00:00 2001
Message-ID: <059a3289bce7bf6bc363294a06eee8ad4ba46aa2.1710860841.git.jdenemar@redhat.com>
From: Jiri Denemark <jdenemar@redhat.com>
Date: Thu, 7 Mar 2024 14:04:21 +0100
Subject: [PATCH] Add vmx-* features to Nehalem*

Signed-off-by: Jiri Denemark <jdenemar@redhat.com>
Reviewed-by: Tim Wiederhake <twiederh@redhat.com>
(cherry picked from commit a539910c942f5993b967f8265756e3a10363e4f4)
https://issues.redhat.com/browse/RHEL-25995

Signed-off-by: Jiri Denemark <jdenemar@redhat.com>
---
 src/cpu_map/x86_Nehalem-IBRS.xml | 61 ++++++++++++++++++++++++++++++++
 src/cpu_map/x86_Nehalem.xml      | 61 ++++++++++++++++++++++++++++++++
 2 files changed, 122 insertions(+)

diff --git a/src/cpu_map/x86_Nehalem-IBRS.xml b/src/cpu_map/x86_Nehalem-IBRS.xml
index 00d0d2fe51..0cfee14c0f 100644
--- a/src/cpu_map/x86_Nehalem-IBRS.xml
+++ b/src/cpu_map/x86_Nehalem-IBRS.xml
@@ -38,5 +38,66 @@
     <feature name='ssse3'/>
     <feature name='syscall'/>
     <feature name='tsc'/>
+    <feature name='vmx-activity-hlt' added='yes'/>
+    <feature name='vmx-apicv-x2apic' added='yes'/>
+    <feature name='vmx-apicv-xapic' added='yes'/>
+    <feature name='vmx-cr3-load-noexit' added='yes'/>
+    <feature name='vmx-cr3-store-noexit' added='yes'/>
+    <feature name='vmx-cr8-load-exit' added='yes'/>
+    <feature name='vmx-cr8-store-exit' added='yes'/>
+    <feature name='vmx-desc-exit' added='yes'/>
+    <feature name='vmx-entry-ia32e-mode' added='yes'/>
+    <feature name='vmx-entry-load-efer' added='yes'/>
+    <feature name='vmx-entry-load-pat' added='yes'/>
+    <feature name='vmx-entry-load-perf-global-ctrl' added='yes'/>
+    <feature name='vmx-entry-noload-debugctl' added='yes'/>
+    <feature name='vmx-ept' added='yes'/>
+    <feature name='vmx-ept-1gb' added='yes'/>
+    <feature name='vmx-ept-2mb' added='yes'/>
+    <feature name='vmx-ept-execonly' added='yes'/>
+    <feature name='vmx-ept-wb' added='yes'/>
+    <feature name='vmx-exit-ack-intr' added='yes'/>
+    <feature name='vmx-exit-load-efer' added='yes'/>
+    <feature name='vmx-exit-load-pat' added='yes'/>
+    <feature name='vmx-exit-load-perf-global-ctrl' added='yes'/>
+    <feature name='vmx-exit-nosave-debugctl' added='yes'/>
+    <feature name='vmx-exit-save-efer' added='yes'/>
+    <feature name='vmx-exit-save-pat' added='yes'/>
+    <feature name='vmx-exit-save-preemption-timer' added='yes'/>
+    <feature name='vmx-flexpriority' added='yes'/>
+    <feature name='vmx-hlt-exit' added='yes'/>
+    <feature name='vmx-ins-outs' added='yes'/>
+    <feature name='vmx-intr-exit' added='yes'/>
+    <feature name='vmx-invept' added='yes'/>
+    <feature name='vmx-invept-all-context' added='yes'/>
+    <feature name='vmx-invept-single-context' added='yes'/>
+    <feature name='vmx-invlpg-exit' added='yes'/>
+    <feature name='vmx-invvpid' added='yes'/>
+    <feature name='vmx-invvpid-all-context' added='yes'/>
+    <feature name='vmx-invvpid-single-addr' added='yes'/>
+    <feature name='vmx-invvpid-single-context' added='yes'/>
+    <feature name='vmx-invvpid-single-context-noglobals' added='yes'/>
+    <feature name='vmx-io-bitmap' added='yes'/>
+    <feature name='vmx-io-exit' added='yes'/>
+    <feature name='vmx-monitor-exit' added='yes'/>
+    <feature name='vmx-movdr-exit' added='yes'/>
+    <feature name='vmx-msr-bitmap' added='yes'/>
+    <feature name='vmx-mtf' added='yes'/>
+    <feature name='vmx-mwait-exit' added='yes'/>
+    <feature name='vmx-nmi-exit' added='yes'/>
+    <feature name='vmx-page-walk-4' added='yes'/>
+    <feature name='vmx-pause-exit' added='yes'/>
+    <feature name='vmx-preemption-timer' added='yes'/>
+    <feature name='vmx-rdpmc-exit' added='yes'/>
+    <feature name='vmx-rdtsc-exit' added='yes'/>
+    <feature name='vmx-rdtscp-exit' added='yes'/>
+    <feature name='vmx-secondary-ctls' added='yes'/>
+    <feature name='vmx-true-ctls' added='yes'/>
+    <feature name='vmx-tsc-offset' added='yes'/>
+    <feature name='vmx-vintr-pending' added='yes'/>
+    <feature name='vmx-vnmi' added='yes'/>
+    <feature name='vmx-vnmi-pending' added='yes'/>
+    <feature name='vmx-vpid' added='yes'/>
+    <feature name='vmx-wbinvd-exit' added='yes'/>
   </model>
 </cpus>
diff --git a/src/cpu_map/x86_Nehalem.xml b/src/cpu_map/x86_Nehalem.xml
index 9968001fe7..74ee64ce1c 100644
--- a/src/cpu_map/x86_Nehalem.xml
+++ b/src/cpu_map/x86_Nehalem.xml
@@ -37,5 +37,66 @@
     <feature name='ssse3'/>
     <feature name='syscall'/>
     <feature name='tsc'/>
+    <feature name='vmx-activity-hlt' added='yes'/>
+    <feature name='vmx-apicv-x2apic' added='yes'/>
+    <feature name='vmx-apicv-xapic' added='yes'/>
+    <feature name='vmx-cr3-load-noexit' added='yes'/>
+    <feature name='vmx-cr3-store-noexit' added='yes'/>
+    <feature name='vmx-cr8-load-exit' added='yes'/>
+    <feature name='vmx-cr8-store-exit' added='yes'/>
+    <feature name='vmx-desc-exit' added='yes'/>
+    <feature name='vmx-entry-ia32e-mode' added='yes'/>
+    <feature name='vmx-entry-load-efer' added='yes'/>
+    <feature name='vmx-entry-load-pat' added='yes'/>
+    <feature name='vmx-entry-load-perf-global-ctrl' added='yes'/>
+    <feature name='vmx-entry-noload-debugctl' added='yes'/>
+    <feature name='vmx-ept' added='yes'/>
+    <feature name='vmx-ept-1gb' added='yes'/>
+    <feature name='vmx-ept-2mb' added='yes'/>
+    <feature name='vmx-ept-execonly' added='yes'/>
+    <feature name='vmx-ept-wb' added='yes'/>
+    <feature name='vmx-exit-ack-intr' added='yes'/>
+    <feature name='vmx-exit-load-efer' added='yes'/>
+    <feature name='vmx-exit-load-pat' added='yes'/>
+    <feature name='vmx-exit-load-perf-global-ctrl' added='yes'/>
+    <feature name='vmx-exit-nosave-debugctl' added='yes'/>
+    <feature name='vmx-exit-save-efer' added='yes'/>
+    <feature name='vmx-exit-save-pat' added='yes'/>
+    <feature name='vmx-exit-save-preemption-timer' added='yes'/>
+    <feature name='vmx-flexpriority' added='yes'/>
+    <feature name='vmx-hlt-exit' added='yes'/>
+    <feature name='vmx-ins-outs' added='yes'/>
+    <feature name='vmx-intr-exit' added='yes'/>
+    <feature name='vmx-invept' added='yes'/>
+    <feature name='vmx-invept-all-context' added='yes'/>
+    <feature name='vmx-invept-single-context' added='yes'/>
+    <feature name='vmx-invlpg-exit' added='yes'/>
+    <feature name='vmx-invvpid' added='yes'/>
+    <feature name='vmx-invvpid-all-context' added='yes'/>
+    <feature name='vmx-invvpid-single-addr' added='yes'/>
+    <feature name='vmx-invvpid-single-context' added='yes'/>
+    <feature name='vmx-invvpid-single-context-noglobals' added='yes'/>
+    <feature name='vmx-io-bitmap' added='yes'/>
+    <feature name='vmx-io-exit' added='yes'/>
+    <feature name='vmx-monitor-exit' added='yes'/>
+    <feature name='vmx-movdr-exit' added='yes'/>
+    <feature name='vmx-msr-bitmap' added='yes'/>
+    <feature name='vmx-mtf' added='yes'/>
+    <feature name='vmx-mwait-exit' added='yes'/>
+    <feature name='vmx-nmi-exit' added='yes'/>
+    <feature name='vmx-page-walk-4' added='yes'/>
+    <feature name='vmx-pause-exit' added='yes'/>
+    <feature name='vmx-preemption-timer' added='yes'/>
+    <feature name='vmx-rdpmc-exit' added='yes'/>
+    <feature name='vmx-rdtsc-exit' added='yes'/>
+    <feature name='vmx-rdtscp-exit' added='yes'/>
+    <feature name='vmx-secondary-ctls' added='yes'/>
+    <feature name='vmx-true-ctls' added='yes'/>
+    <feature name='vmx-tsc-offset' added='yes'/>
+    <feature name='vmx-vintr-pending' added='yes'/>
+    <feature name='vmx-vnmi' added='yes'/>
+    <feature name='vmx-vnmi-pending' added='yes'/>
+    <feature name='vmx-vpid' added='yes'/>
+    <feature name='vmx-wbinvd-exit' added='yes'/>
   </model>
 </cpus>
-- 
2.44.0
