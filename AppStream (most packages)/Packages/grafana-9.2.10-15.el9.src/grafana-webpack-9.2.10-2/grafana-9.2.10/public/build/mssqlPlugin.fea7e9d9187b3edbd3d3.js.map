{"version":3,"file":"mssqlPlugin.fea7e9d9187b3edbd3d3.js","mappings":"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","sources":["webpack://grafana/./public/app/plugins/datasource/mssql/types.ts","webpack://grafana/./public/app/plugins/datasource/mssql/configuration/ConfigurationEditor.tsx","webpack://grafana/./public/app/plugins/datasource/mssql/MSSqlQueryModel.ts","webpack://grafana/./public/app/plugins/datasource/mssql/response_parser.ts","webpack://grafana/./public/app/plugins/datasource/mssql/sqlCompletionProvider.ts","webpack://grafana/./public/app/plugins/datasource/mssql/sqlUtil.ts","webpack://grafana/./public/app/plugins/datasource/mssql/datasource.ts","webpack://grafana/./public/app/plugins/datasource/mssql/MSSqlMetaQuery.ts","webpack://grafana/./public/app/plugins/datasource/mssql/module.ts"],"sourcesContent":["import { SQLOptions } from 'app/features/plugins/sql/types';\n\nexport enum MSSQLAuthenticationType {\n  sqlAuth = 'SQL Server Authentication',\n  windowsAuth = 'Windows Authentication',\n}\n\nexport enum MSSQLEncryptOptions {\n  disable = 'disable',\n  false = 'false',\n  true = 'true',\n}\nexport interface MssqlOptions extends SQLOptions {\n  authenticationType?: MSSQLAuthenticationType;\n  encrypt?: MSSQLEncryptOptions;\n  sslRootCertFile?: string;\n  serverName?: string;\n}\n","import { css } from '@emotion/css';\nimport React, { SyntheticEvent } from 'react';\n\nimport {\n  DataSourcePluginOptionsEditorProps,\n  GrafanaTheme2,\n  onUpdateDatasourceJsonDataOption,\n  onUpdateDatasourceSecureJsonDataOption,\n  SelectableValue,\n  updateDatasourcePluginJsonDataOption,\n  updateDatasourcePluginResetOption,\n} from '@grafana/data';\nimport {\n  Alert,\n  FieldSet,\n  InlineField,\n  InlineFieldRow,\n  InlineSwitch,\n  Input,\n  SecretInput,\n  Select,\n  useStyles2,\n} from '@grafana/ui';\nimport { ConnectionLimits } from 'app/features/plugins/sql/components/configuration/ConnectionLimits';\n\nimport { MSSQLAuthenticationType, MSSQLEncryptOptions, MssqlOptions } from '../types';\n\nexport const ConfigurationEditor = (props: DataSourcePluginOptionsEditorProps<MssqlOptions>) => {\n  const { options, onOptionsChange } = props;\n  const styles = useStyles2(getStyles);\n  const jsonData = options.jsonData;\n\n  const onResetPassword = () => {\n    updateDatasourcePluginResetOption(props, 'password');\n  };\n\n  const onDSOptionChanged = (property: keyof MssqlOptions) => {\n    return (event: SyntheticEvent<HTMLInputElement>) => {\n      onOptionsChange({ ...options, ...{ [property]: event.currentTarget.value } });\n    };\n  };\n\n  const onSkipTLSVerifyChanged = (event: SyntheticEvent<HTMLInputElement>) => {\n    updateDatasourcePluginJsonDataOption(props, 'tlsSkipVerify', event.currentTarget.checked);\n  };\n\n  const onEncryptChanged = (value: SelectableValue) => {\n    updateDatasourcePluginJsonDataOption(props, 'encrypt', value.value);\n  };\n\n  const onAuthenticationMethodChanged = (value: SelectableValue) => {\n    onOptionsChange({\n      ...options,\n      ...{\n        jsonData: { ...jsonData, ...{ authenticationType: value.value } },\n        secureJsonData: { ...options.secureJsonData, ...{ password: '' } },\n        secureJsonFields: { ...options.secureJsonFields, ...{ password: false } },\n        user: '',\n      },\n    });\n  };\n\n  const authenticationOptions: Array<SelectableValue<MSSQLAuthenticationType>> = [\n    { value: MSSQLAuthenticationType.sqlAuth, label: 'SQL Server Authentication' },\n    { value: MSSQLAuthenticationType.windowsAuth, label: 'Windows Authentication' },\n  ];\n\n  const encryptOptions: Array<SelectableValue<string>> = [\n    { value: MSSQLEncryptOptions.disable, label: 'disable' },\n    { value: MSSQLEncryptOptions.false, label: 'false' },\n    { value: MSSQLEncryptOptions.true, label: 'true' },\n  ];\n\n  const shortWidth = 15;\n  const longWidth = 46;\n  const labelWidthSSL = 25;\n\n  return (\n    <>\n      <FieldSet label=\"MS SQL Connection\" width={400}>\n        <InlineField labelWidth={shortWidth} label=\"Host\">\n          <Input\n            width={longWidth}\n            name=\"host\"\n            type=\"text\"\n            value={options.url || ''}\n            placeholder=\"localhost:1433\"\n            onChange={onDSOptionChanged('url')}\n          ></Input>\n        </InlineField>\n        <InlineField labelWidth={shortWidth} label=\"Database\">\n          <Input\n            width={longWidth}\n            name=\"database\"\n            value={options.database || ''}\n            placeholder=\"database name\"\n            onChange={onDSOptionChanged('database')}\n          ></Input>\n        </InlineField>\n        <InlineField\n          label=\"Authentication\"\n          labelWidth={shortWidth}\n          htmlFor=\"authenticationType\"\n          tooltip={\n            <ul className={styles.ulPadding}>\n              <li>\n                <i>SQL Server Authentication</i> This is the default mechanism to connect to MS SQL Server. Enter the\n                SQL Server Authentication login or the Windows Authentication login in the DOMAIN\\User format.\n              </li>\n              <li>\n                <i>Windows Authentication</i> Windows Integrated Security - single sign on for users who are already\n                logged onto Windows and have enabled this option for MS SQL Server.\n              </li>\n            </ul>\n          }\n        >\n          <Select\n            value={jsonData.authenticationType || MSSQLAuthenticationType.sqlAuth}\n            inputId=\"authenticationType\"\n            options={authenticationOptions}\n            onChange={onAuthenticationMethodChanged}\n          ></Select>\n        </InlineField>\n        {jsonData.authenticationType === MSSQLAuthenticationType.windowsAuth ? null : (\n          <InlineFieldRow>\n            <InlineField labelWidth={shortWidth} label=\"User\">\n              <Input\n                width={shortWidth}\n                value={options.user || ''}\n                placeholder=\"user\"\n                onChange={onDSOptionChanged('user')}\n              ></Input>\n            </InlineField>\n            <InlineField label=\"Password\" labelWidth={shortWidth}>\n              <SecretInput\n                width={shortWidth}\n                placeholder=\"Password\"\n                isConfigured={options.secureJsonFields && options.secureJsonFields.password}\n                onReset={onResetPassword}\n                onBlur={onUpdateDatasourceSecureJsonDataOption(props, 'password')}\n              ></SecretInput>\n            </InlineField>\n          </InlineFieldRow>\n        )}\n      </FieldSet>\n\n      <FieldSet label=\"TLS/SSL Auth\">\n        <InlineField\n          labelWidth={labelWidthSSL}\n          htmlFor=\"encrypt\"\n          tooltip={\n            <>\n              Determines whether or to which extent a secure SSL TCP/IP connection will be negotiated with the server.\n              <ul className={styles.ulPadding}>\n                <li>\n                  <i>disable</i> - Data sent between client and server is not encrypted.\n                </li>\n                <li>\n                  <i>false</i> - Data sent between client and server is not encrypted beyond the login packet. (default)\n                </li>\n                <li>\n                  <i>true</i> - Data sent between client and server is encrypted.\n                </li>\n              </ul>\n              If you&apos;re using an older version of Microsoft SQL Server like 2008 and 2008R2 you may need to disable\n              encryption to be able to connect.\n            </>\n          }\n          label=\"Encrypt\"\n        >\n          <Select\n            options={encryptOptions}\n            value={jsonData.encrypt || MSSQLEncryptOptions.disable}\n            inputId=\"encrypt\"\n            onChange={onEncryptChanged}\n          ></Select>\n        </InlineField>\n\n        {jsonData.encrypt === MSSQLEncryptOptions.true ? (\n          <>\n            <InlineField labelWidth={labelWidthSSL} htmlFor=\"skipTlsVerify\" label=\"Skip TLS Verify\">\n              <InlineSwitch\n                id=\"skipTlsVerify\"\n                onChange={onSkipTLSVerifyChanged}\n                value={jsonData.tlsSkipVerify || false}\n              ></InlineSwitch>\n            </InlineField>\n            {jsonData.tlsSkipVerify ? null : (\n              <>\n                <InlineField\n                  labelWidth={labelWidthSSL}\n                  tooltip={\n                    <span>\n                      Path to file containing the public key certificate of the CA that signed the SQL Server\n                      certificate. Needed when the server certificate is self signed.\n                    </span>\n                  }\n                  label=\"TLS/SSL Root Certificate\"\n                >\n                  <Input\n                    value={jsonData.sslRootCertFile || ''}\n                    onChange={onUpdateDatasourceJsonDataOption(props, 'sslRootCertFile')}\n                    placeholder=\"TLS/SSL root certificate file path\"\n                  ></Input>\n                </InlineField>\n                <InlineField labelWidth={labelWidthSSL} label=\"Hostname in server certificate\">\n                  <Input\n                    placeholder=\"Common Name (CN) in server certificate\"\n                    value={jsonData.serverName || ''}\n                    onChange={onUpdateDatasourceJsonDataOption(props, 'serverName')}\n                  ></Input>\n                </InlineField>\n              </>\n            )}\n          </>\n        ) : null}\n      </FieldSet>\n\n      <ConnectionLimits\n        labelWidth={shortWidth}\n        jsonData={jsonData}\n        onPropertyChanged={(property, value) => {\n          updateDatasourcePluginJsonDataOption(props, property, value);\n        }}\n      ></ConnectionLimits>\n\n      <FieldSet label=\"MS SQL details\">\n        <InlineField\n          tooltip={\n            <span>\n              A lower limit for the auto group by time interval. Recommended to be set to write frequency, for example\n              <code>1m</code> if your data is written every minute.\n            </span>\n          }\n          label=\"Min time interval\"\n        >\n          <Input\n            placeholder=\"1m\"\n            value={jsonData.timeInterval || ''}\n            onChange={onUpdateDatasourceJsonDataOption(props, 'timeInterval')}\n          ></Input>\n        </InlineField>\n      </FieldSet>\n\n      <Alert title=\"User Permission\" severity=\"info\">\n        The database user should only be granted SELECT permissions on the specified database and tables you want to\n        query. Grafana does not validate that queries are safe so queries can contain any SQL statement. For example,\n        statements like <code>USE otherdb;</code> and <code>DROP TABLE user;</code> would be executed. To protect\n        against this we <em>highly</em> recommmend you create a specific MS SQL user with restricted permissions.\n      </Alert>\n    </>\n  );\n};\n\nfunction getStyles(theme: GrafanaTheme2) {\n  return {\n    ulPadding: css({\n      margin: theme.spacing(1, 0),\n      paddingLeft: theme.spacing(5),\n    }),\n  };\n}\n","import { ScopedVars } from '@grafana/data';\nimport { TemplateSrv } from '@grafana/runtime';\nimport { applyQueryDefaults } from 'app/features/plugins/sql/defaults';\nimport { SQLQuery, SqlQueryModel } from 'app/features/plugins/sql/types';\n\nexport class MSSqlQueryModel implements SqlQueryModel {\n  target: SQLQuery;\n  templateSrv?: TemplateSrv;\n  scopedVars?: ScopedVars;\n\n  constructor(target?: SQLQuery, templateSrv?: TemplateSrv, scopedVars?: ScopedVars) {\n    this.target = applyQueryDefaults(target || { refId: 'A' });\n    this.templateSrv = templateSrv;\n    this.scopedVars = scopedVars;\n  }\n\n  quoteLiteral(value: string) {\n    return \"'\" + value.replace(/'/g, \"''\") + \"'\";\n  }\n}\n","import { uniqBy } from 'lodash';\n\nimport { DataFrame, MetricFindValue } from '@grafana/data';\nimport { ResponseParser } from 'app/features/plugins/sql/types';\n\nexport class MSSqlResponseParser implements ResponseParser {\n  transformMetricFindResponse(frame: DataFrame): MetricFindValue[] {\n    const values: MetricFindValue[] = [];\n    const textField = frame.fields.find((f) => f.name === '__text');\n    const valueField = frame.fields.find((f) => f.name === '__value');\n\n    if (textField && valueField) {\n      for (let i = 0; i < textField.values.length; i++) {\n        values.push({ text: '' + textField.values.get(i), value: '' + valueField.values.get(i) });\n      }\n    } else {\n      values.push(\n        ...frame.fields\n          .flatMap((f) => f.values.toArray())\n          .map((v) => ({\n            text: v,\n          }))\n      );\n    }\n\n    return uniqBy(values, 'text');\n  }\n}\n","import {\n  ColumnDefinition,\n  getStandardSQLCompletionProvider,\n  LanguageCompletionProvider,\n  LinkedToken,\n  TableDefinition,\n  TableIdentifier,\n  TokenType,\n} from '@grafana/experimental';\nimport { DB, SQLQuery } from 'app/features/plugins/sql/types';\n\ninterface CompletionProviderGetterArgs {\n  getColumns: React.MutableRefObject<(t: SQLQuery) => Promise<ColumnDefinition[]>>;\n  getTables: React.MutableRefObject<(d?: string) => Promise<TableDefinition[]>>;\n}\n\nexport const getSqlCompletionProvider: (args: CompletionProviderGetterArgs) => LanguageCompletionProvider =\n  ({ getColumns, getTables }) =>\n  (monaco, language) => ({\n    ...(language && getStandardSQLCompletionProvider(monaco, language)),\n    tables: {\n      resolve: async (identifier) => {\n        return await getTables.current(identifier.table);\n      },\n      parseName: (token: LinkedToken) => {\n        if (!token) {\n          return { table: '' };\n        }\n\n        let processedToken = token;\n        let tablePath = processedToken.value;\n\n        while (processedToken.next && processedToken.next.type !== TokenType.Whitespace) {\n          tablePath += processedToken.next.value;\n          processedToken = processedToken.next;\n        }\n\n        if (processedToken.value.endsWith('.')) {\n          tablePath = processedToken.value.slice(0, processedToken.value.length - 1);\n        }\n\n        return { table: tablePath };\n      },\n    },\n\n    columns: {\n      resolve: async (t: TableIdentifier | undefined) => {\n        if (!t?.table) {\n          return [];\n        }\n        // TODO: Use schema instead of table\n        const [database, schema, tableName] = t.table.split('.');\n        return await getColumns.current({ table: `${schema}.${tableName}`, dataset: database, refId: 'A' });\n      },\n    },\n  });\n\nexport async function fetchColumns(db: DB, q: SQLQuery) {\n  const cols = await db.fields(q);\n  if (cols.length > 0) {\n    return cols.map((c) => {\n      return { name: c.value, type: c.value, description: c.value };\n    });\n  } else {\n    return [];\n  }\n}\n\nexport async function fetchTables(db: DB, dataset?: string) {\n  const tables = await db.lookup?.(dataset);\n  return tables || [];\n}\n","import { isEmpty } from 'lodash';\n\nimport { RAQBFieldTypes, SQLExpression, SQLQuery } from 'app/features/plugins/sql/types';\nimport { haveColumns } from 'app/features/plugins/sql/utils/sql.utils';\n\nexport function getIcon(type: string): string | undefined {\n  switch (type) {\n    case 'datetimeoffset':\n    case 'date':\n    case 'datetime2':\n    case 'smalldatetime':\n    case 'datetime':\n    case 'time':\n      return 'clock-nine';\n    case 'bit':\n      return 'toggle-off';\n    case 'tinyint':\n    case 'smallint':\n    case 'int':\n    case 'bigint':\n    case 'decimal':\n    case 'numeric':\n    case 'real':\n    case 'float':\n    case 'money':\n    case 'smallmoney':\n      return 'calculator-alt';\n    case 'char':\n    case 'varchar':\n    case 'text':\n    case 'nchar':\n    case 'nvarchar':\n    case 'ntext':\n    case 'binary':\n    case 'varbinary':\n    case 'image':\n      return 'text';\n    default:\n      return undefined;\n  }\n}\n\nexport function getRAQBType(type: string): RAQBFieldTypes {\n  switch (type) {\n    case 'datetimeoffset':\n    case 'datetime2':\n    case 'smalldatetime':\n    case 'datetime':\n      return 'datetime';\n    case 'time':\n      return 'time';\n    case 'date':\n      return 'date';\n    case 'bit':\n      return 'boolean';\n    case 'tinyint':\n    case 'smallint':\n    case 'int':\n    case 'bigint':\n    case 'decimal':\n    case 'numeric':\n    case 'real':\n    case 'float':\n    case 'money':\n    case 'smallmoney':\n      return 'number';\n    case 'char':\n    case 'varchar':\n    case 'text':\n    case 'nchar':\n    case 'nvarchar':\n    case 'ntext':\n    case 'binary':\n    case 'varbinary':\n    case 'image':\n      return 'text';\n    default:\n      return 'text';\n  }\n}\n\nexport function toRawSql({ sql, dataset, table }: SQLQuery): string {\n  let rawQuery = '';\n\n  // Return early with empty string if there is no sql column\n  if (!sql || !haveColumns(sql.columns)) {\n    return rawQuery;\n  }\n\n  rawQuery += createSelectClause(sql.columns, sql.limit);\n\n  if (dataset && table) {\n    rawQuery += `FROM ${dataset}.${table} `;\n  }\n\n  if (sql.whereString) {\n    rawQuery += `WHERE ${sql.whereString} `;\n  }\n\n  if (sql.groupBy?.[0]?.property.name) {\n    const groupBy = sql.groupBy.map((g) => g.property.name).filter((g) => !isEmpty(g));\n    rawQuery += `GROUP BY ${groupBy.join(', ')} `;\n  }\n\n  if (sql.orderBy?.property.name) {\n    rawQuery += `ORDER BY ${sql.orderBy.property.name} `;\n  }\n\n  if (sql.orderBy?.property.name && sql.orderByDirection) {\n    rawQuery += `${sql.orderByDirection} `;\n  }\n\n  return rawQuery;\n}\n\nfunction createSelectClause(sqlColumns: NonNullable<SQLExpression['columns']>, limit?: number): string {\n  const columns = sqlColumns.map((c) => {\n    let rawColumn = '';\n    if (c.name) {\n      rawColumn += `${c.name}(${c.parameters?.map((p) => `${p.name}`)})`;\n    } else {\n      rawColumn += `${c.parameters?.map((p) => `${p.name}`)}`;\n    }\n    return rawColumn;\n  });\n  return `SELECT ${isLimit(limit) ? 'TOP(' + limit + ')' : ''} ${columns.join(', ')} `;\n}\n\nconst isLimit = (limit: number | undefined): boolean => limit !== undefined && limit >= 0;\n","import { DataSourceInstanceSettings, ScopedVars } from '@grafana/data';\nimport { LanguageDefinition } from '@grafana/experimental';\nimport { TemplateSrv } from '@grafana/runtime';\nimport { SqlDatasource } from 'app/features/plugins/sql/datasource/SqlDatasource';\nimport { DB, ResponseParser, SQLQuery, SQLSelectableValue } from 'app/features/plugins/sql/types';\nimport { formatSQL } from 'app/features/plugins/sql/utils/formatSQL';\n\nimport { getSchema, showDatabases, getSchemaAndName } from './MSSqlMetaQuery';\nimport { MSSqlQueryModel } from './MSSqlQueryModel';\nimport { MSSqlResponseParser } from './response_parser';\nimport { fetchColumns, fetchTables, getSqlCompletionProvider } from './sqlCompletionProvider';\nimport { getIcon, getRAQBType, toRawSql } from './sqlUtil';\nimport { MssqlOptions } from './types';\n\nexport class MssqlDatasource extends SqlDatasource {\n  sqlLanguageDefinition: LanguageDefinition | undefined = undefined;\n  constructor(instanceSettings: DataSourceInstanceSettings<MssqlOptions>) {\n    super(instanceSettings);\n  }\n\n  getQueryModel(target?: SQLQuery, templateSrv?: TemplateSrv, scopedVars?: ScopedVars): MSSqlQueryModel {\n    return new MSSqlQueryModel(target, templateSrv, scopedVars);\n  }\n\n  getResponseParser(): ResponseParser {\n    return new MSSqlResponseParser();\n  }\n\n  async fetchDatasets(): Promise<string[]> {\n    const datasets = await this.runSql<{ name: string[] }>(showDatabases(), { refId: 'datasets' });\n    return datasets.fields.name.values.toArray().flat();\n  }\n\n  async fetchTables(dataset?: string): Promise<string[]> {\n    // We get back the table name with the schema as well. like dbo.table\n    const tables = await this.runSql<{ schemaAndName: string[] }>(getSchemaAndName(dataset), { refId: 'tables' });\n    return tables.fields.schemaAndName.values.toArray().flat();\n  }\n\n  async fetchFields(query: SQLQuery): Promise<SQLSelectableValue[]> {\n    if (!query.table) {\n      return [];\n    }\n    const [_, table] = query.table.split('.');\n    const schema = await this.runSql<{ column: string; type: string }>(getSchema(query.dataset, table), {\n      refId: 'columns',\n    });\n    const result: SQLSelectableValue[] = [];\n    for (let i = 0; i < schema.length; i++) {\n      const column = schema.fields.column.values.get(i);\n      const type = schema.fields.type.values.get(i);\n      result.push({ label: column, value: column, type, icon: getIcon(type), raqbFieldType: getRAQBType(type) });\n    }\n    return result;\n  }\n\n  getSqlLanguageDefinition(db: DB): LanguageDefinition {\n    if (this.sqlLanguageDefinition !== undefined) {\n      return this.sqlLanguageDefinition;\n    }\n    const args = {\n      getColumns: { current: (query: SQLQuery) => fetchColumns(db, query) },\n      getTables: { current: (dataset?: string) => fetchTables(db, dataset) },\n    };\n    this.sqlLanguageDefinition = {\n      id: 'sql',\n      completionProvider: getSqlCompletionProvider(args),\n      formatter: formatSQL,\n    };\n    return this.sqlLanguageDefinition;\n  }\n\n  getDB(): DB {\n    if (this.db !== undefined) {\n      return this.db;\n    }\n    return {\n      init: () => Promise.resolve(true),\n      datasets: () => this.fetchDatasets(),\n      tables: (dataset?: string) => this.fetchTables(dataset),\n      getEditorLanguageDefinition: () => this.getSqlLanguageDefinition(this.db),\n      fields: async (query: SQLQuery) => {\n        if (!query?.dataset || !query?.table) {\n          return [];\n        }\n        return this.fetchFields(query);\n      },\n      validateQuery: (query) =>\n        Promise.resolve({ isError: false, isValid: true, query, error: '', rawSql: query.rawSql }),\n      dsID: () => this.id,\n      dispose: (dsID?: string) => {},\n      toRawSql,\n      lookup: async (path?: string) => {\n        if (!path) {\n          const datasets = await this.fetchDatasets();\n          return datasets.map((d) => ({ name: d, completion: `${d}.` }));\n        } else {\n          const parts = path.split('.').filter((s: string) => s);\n          if (parts.length > 2) {\n            return [];\n          }\n          if (parts.length === 1) {\n            const tables = await this.fetchTables(parts[0]);\n            return tables.map((t) => ({ name: t, completion: t }));\n          } else {\n            return [];\n          }\n        }\n      },\n    };\n  }\n}\n","export function showDatabases() {\n  // Return only user defined databases\n  return `SELECT name FROM sys.databases WHERE name NOT IN ('master', 'tempdb', 'model', 'msdb');`;\n}\n\nexport function getSchemaAndName(database?: string) {\n  return `SELECT TABLE_SCHEMA + '.' + TABLE_NAME as schemaAndName\n    FROM [${database}].INFORMATION_SCHEMA.TABLES\n    WHERE TABLE_TYPE = 'BASE TABLE'`;\n}\n\nexport function getSchema(database?: string, table?: string) {\n  return `\n   USE ${database}\n   SELECT COLUMN_NAME as 'column',DATA_TYPE as 'type'\n   FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME='${table}';`;\n}\n","import { DataSourcePlugin } from '@grafana/data';\nimport { SqlQueryEditor } from 'app/features/plugins/sql/components/QueryEditor';\nimport { SQLQuery } from 'app/features/plugins/sql/types';\n\nimport { ConfigurationEditor } from './configuration/ConfigurationEditor';\nimport { MssqlDatasource } from './datasource';\nimport { MssqlOptions } from './types';\n\nexport const plugin = new DataSourcePlugin<MssqlDatasource, SQLQuery, MssqlOptions>(MssqlDatasource)\n  .setQueryEditor(SqlQueryEditor)\n  .setConfigEditor(ConfigurationEditor);\n"],"names":["MSSQLAuthenticationType","MSSQLEncryptOptions","getStyles","theme","ulPadding","css","margin","spacing","paddingLeft","MSSqlQueryModel","constructor","target","templateSrv","scopedVars","this","applyQueryDefaults","refId","quoteLiteral","value","replace","MSSqlResponseParser","transformMetricFindResponse","frame","values","textField","fields","find","f","name","valueField","i","length","push","text","get","flatMap","toArray","map","v","uniqBy","getSqlCompletionProvider","getColumns","getTables","monaco","language","getStandardSQLCompletionProvider","tables","resolve","async","current","identifier","table","parseName","token","processedToken","tablePath","next","type","TokenType","endsWith","slice","columns","t","database","schema","tableName","split","dataset","getIcon","getRAQBType","toRawSql","sql","rawQuery","haveColumns","sqlColumns","limit","c","rawColumn","parameters","p","isLimit","join","createSelectClause","whereString","groupBy","property","g","filter","isEmpty","orderBy","orderByDirection","undefined","MssqlDatasource","SqlDatasource","instanceSettings","super","getQueryModel","getResponseParser","runSql","flat","schemaAndName","query","_","getSchema","result","column","label","icon","raqbFieldType","getSqlLanguageDefinition","db","sqlLanguageDefinition","args","q","cols","description","fetchColumns","lookup","fetchTables","id","completionProvider","formatter","formatSQL","getDB","init","Promise","datasets","fetchDatasets","getEditorLanguageDefinition","fetchFields","validateQuery","isError","isValid","error","rawSql","dsID","dispose","path","parts","s","completion","d","plugin","DataSourcePlugin","setQueryEditor","SqlQueryEditor","setConfigEditor","props","options","onOptionsChange","styles","useStyles2","jsonData","onDSOptionChanged","event","currentTarget","authenticationOptions","sqlAuth","windowsAuth","encryptOptions","disable","shortWidth","FieldSet","width","InlineField","labelWidth","Input","I","url","placeholder","onChange","htmlFor","tooltip","className","Select","authenticationType","inputId","secureJsonData","password","secureJsonFields","user","InlineFieldRow","SecretInput","isConfigured","onReset","updateDatasourcePluginResetOption","onBlur","onUpdateDatasourceSecureJsonDataOption","encrypt","updateDatasourcePluginJsonDataOption","checked","tlsSkipVerify","sslRootCertFile","onUpdateDatasourceJsonDataOption","serverName","ConnectionLimits","onPropertyChanged","timeInterval","Alert","title","severity"],"sourceRoot":""}