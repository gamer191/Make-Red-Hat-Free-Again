(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[4251],{54776:(e,t,a)=>{"use strict";a.d(t,{d:()=>h});a(76687);var s,i,n,r=a(68786),l=a(50385),o=a(77524),c=a(52010);const h=e=>{const{labelWidth:t,editorProps:a,showCACert:h,showKeyPair:d=!0}=e,{secureJsonFields:u}=a.options;return(0,c.jsxs)(c.Fragment,{children:[d?(0,c.jsx)(l._,{tooltip:s||(s=(0,c.jsx)("span",{children:"To authenticate with an TLS/SSL client certificate, provide the client certificate here."})),labelWidth:t,label:"TLS/SSL Client Certificate",children:(0,c.jsx)(o.Zk,{placeholder:"Begins with -----BEGIN CERTIFICATE-----",cols:45,rows:7,isConfigured:u&&u.tlsClientCert,onChange:(0,r.fi)(a,"tlsClientCert"),onReset:()=>{(0,r.Mf)(a,"tlsClientCert")}})}):null,h?(0,c.jsx)(l._,{tooltip:i||(i=(0,c.jsx)("span",{children:"If the selected TLS/SSL mode requires a server root certificate, provide it here."})),labelWidth:t,label:"TLS/SSL Root Certificate",children:(0,c.jsx)(o.Zk,{placeholder:"Begins with -----BEGIN CERTIFICATE-----",cols:45,rows:7,isConfigured:u&&u.tlsCACert,onChange:(0,r.fi)(a,"tlsCACert"),onReset:()=>{(0,r.Mf)(a,"tlsCACert")}})}):null,d?(0,c.jsx)(l._,{tooltip:n||(n=(0,c.jsx)("span",{children:"To authenticate with a client TLS/SSL certificate, provide the key here."})),labelWidth:t,label:"TLS/SSL Client Key",children:(0,c.jsx)(o.Zk,{placeholder:"Begins with -----BEGIN RSA PRIVATE KEY-----",cols:45,rows:7,isConfigured:u&&u.tlsClientKey,onChange:(0,r.fi)(a,"tlsClientKey"),onReset:()=>{(0,r.Mf)(a,"tlsClientKey")}})}):null]})}},50184:(e,t,a)=>{"use strict";a.r(t),a.d(t,{plugin:()=>R});var s=a(28594),i=a(4640),n=a(95129),r=a(55534),l=a(49410);function o(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class c{constructor(e,t,a){o(this,"target",void 0),o(this,"templateSrv",void 0),o(this,"scopedVars",void 0),this.target=e,this.templateSrv=t,this.scopedVars=a}unquoteIdentifier(e){return'"'===e[0]&&'"'===e[e.length-1]?e.substring(1,e.length-1).replace(/""/g,'"'):e}quoteIdentifier(e){return'"'+e.replace(/"/g,'""')+'"'}quoteLiteral(e){return"'"+e.replace(/'/g,"''")+"'"}getDatabase(){return this.target.dataset}}var h=a(86832);class d{transformMetricFindResponse(e){const t=[],a=e.fields.find((e=>"__text"===e.name)),s=e.fields.find((e=>"__value"===e.name));if(a&&s)for(let e=0;e<a.values.length;e++)t.push({text:""+a.values.get(e),value:""+s.values.get(e)});else t.push(...e.fields.flatMap((e=>e.values.toArray())).map((e=>({text:e}))));return(0,h.uniqBy)(t,"text")}}function u(e){switch(e){case"TIME":case"DATETIME":case"TIMESTAMP":return"clock-nine";case"BOOLEAN":return"toggle-off";case"INTEGER":case"FLOAT":case"FLOAT64":case"INT":case"SMALLINT":case"BIGINT":case"TINYINT":case"BYTEINT":case"INT64":case"NUMERIC":case"DECIMAL":return"calculator-alt";case"CHAR":case"VARCHAR":case"STRING":case"BYTES":case"TEXT":case"TINYTEXT":case"MEDIUMTEXT":case"LONGTEXT":return"text";case"GEOGRAPHY":return"map";default:return}}function f(e,t,a,s){let i="SELECT column_name, data_type FROM information_schema.columns WHERE ";switch(i+=function(e,t){let a="";if(t.includes(".")){const s=t.split(".");return a="table_schema = "+m(e,s[0]),a+=" AND table_name = "+m(e,s[1]),a}return a=`table_schema = ${void 0!==e.getDatabase()?`'${e.getDatabase()}'`:"database()"} AND table_name = `+m(e,t),a}(e,t),a){case"time":i+=" AND data_type IN ('timestamp','datetime','bigint','int','double','float')";break;case"metric":case"group":i+=" AND data_type IN ('text','tinytext','mediumtext','longtext','varchar','char')";break;case"value":i+=" AND data_type IN ('bigint','int','smallint','mediumint','tinyint','double','decimal','float')",i+=" AND column_name <> "+m(e,s)}return i+=" ORDER BY column_name",i}function m(e,t){return e.quoteLiteral(e.unquoteIdentifier(t))}const p=e=>{let{getMeta:t}=e;return(e,a)=>Object.assign({},a&&(0,n.getStandardSQLCompletionProvider)(e,a),{tables:{resolve:t.current},columns:{resolve:t.current}})};function b(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class g extends r.D{constructor(e){super(e),b(this,"responseParser",void 0),b(this,"sqlLanguageDefinition",void 0),this.instanceSettings=e,this.responseParser=new d}getQueryModel(e,t,a){return new c(e,t,a)}getResponseParser(){return this.responseParser}getSqlLanguageDefinition(e){if(void 0!==this.sqlLanguageDefinition)return this.sqlLanguageDefinition;const t={getMeta:{current:e=>this.fetchMeta(e)}};return this.sqlLanguageDefinition={id:"sql",completionProvider:p(t),formatter:l._},this.sqlLanguageDefinition}async fetchDatasets(){return(await this.runSql("SELECT DISTINCT TABLE_SCHEMA from information_schema.TABLES where TABLE_TYPE != 'SYSTEM VIEW' ORDER BY TABLE_SCHEMA",{refId:"datasets"})).map((e=>e[0]))}async fetchTables(e){const t=await this.runSql(function(e){return`SELECT table_name FROM information_schema.tables WHERE table_schema = ${void 0!==e?`'${e}'`:"database()"} ORDER BY table_name`}(e),{refId:"tables"});return t.map((e=>e[0]))}async fetchFields(e){if(!e.dataset||!e.table)return[];const t=f(this.getQueryModel(e),e.table);return function(e){var t;const a=[];for(const s of e){let e="text";switch(null===(t=s.type)||void 0===t?void 0:t.toUpperCase()){case"BOOLEAN":case"BOOL":e="boolean";break;case"BYTES":case"VARCHAR":case"GEOGRAPHY":e="text";break;case"FLOAT":case"FLOAT64":case"INT":case"INTEGER":case"INT64":case"NUMERIC":case"BIGNUMERIC":e="number";break;case"DATE":e="date";break;case"DATETIME":case"TIMESTAMP":e="datetime";break;case"TIME":e="time"}a.push(Object.assign({},s,{raqbFieldType:e,icon:u(s.type.toUpperCase())}))}return a}((await this.runSql(t,{refId:"fields"})).map((e=>({name:e[0],text:e[0],value:e[0],type:e[1],label:e[0]}))))}async fetchMeta(e){const t=this.instanceSettings.jsonData.database;if(null!=e&&e.schema||!t){if(null!=e&&e.schema||t){if(null!=e&&e.table||t){if(null!=e&&e.table&&e.schema){return(await this.fetchFields({dataset:e.schema,table:e.table})).map((e=>({name:e.value,completion:e.value,kind:n.CompletionItemKind.Field})))}return[]}return(await this.fetchTables(null==e?void 0:e.schema)).map((e=>({name:e,completion:e,kind:n.CompletionItemKind.Class})))}return(await this.fetchDatasets()).map((e=>({name:e,completion:`${e}.`,kind:n.CompletionItemKind.Module})))}return(await this.fetchTables(t)).map((e=>({name:e,completion:`${t}.${e}`,kind:n.CompletionItemKind.Class})))}getDB(){return void 0!==this.db?this.db:{datasets:()=>this.fetchDatasets(),tables:e=>this.fetchTables(e),fields:e=>this.fetchFields(e),validateQuery:(e,t)=>Promise.resolve({query:e,error:"",isError:!1,isValid:!0}),dsID:()=>this.id,functions:()=>["VARIANCE","STDDEV"],getEditorLanguageDefinition:()=>this.getSqlLanguageDefinition(this.db)}}}a(76687);var C,T,E,S=a(68786),x=a(72660),A=a(50385),v=a(9120),I=a(23277),y=a(96845),L=a(46286),j=a(35562),w=a(95296),D=a(76290),_=a(54776),M=a(52010);const R=new s.hf(g).setQueryEditor(i.M).setConfigEditor((e=>{const{options:t,onOptionsChange:a}=e,s=t.jsonData,i=e=>s=>{a(Object.assign({},t,{[e]:s.currentTarget.value}))},n=t=>a=>{(0,S.tp)(e,t,a.currentTarget.checked)},r=15;return(0,M.jsxs)(M.Fragment,{children:[(0,M.jsxs)(x.C,{label:"MySQL Connection",width:400,children:[(0,M.jsx)(A._,{labelWidth:r,label:"Host",children:(0,M.jsx)(v.I,{width:40,name:"host",type:"text",value:t.url||"",placeholder:"localhost:3306",onChange:i("url")})}),(0,M.jsx)(A._,{labelWidth:r,label:"Database",children:(0,M.jsx)(v.I,{width:40,name:"database",value:t.database||"",placeholder:"database name",onChange:i("database")})}),(0,M.jsxs)(I.Z,{children:[(0,M.jsx)(A._,{labelWidth:r,label:"User",children:(0,M.jsx)(v.I,{width:r,value:t.user||"",placeholder:"user",onChange:i("user")})}),(0,M.jsx)(A._,{labelWidth:10,label:"Password",children:(0,M.jsx)(y.m4,{width:r,placeholder:"Password",isConfigured:t.secureJsonFields&&t.secureJsonFields.password,onReset:()=>{(0,S.Mf)(e,"password")},onBlur:(0,S.fi)(e,"password")})})]}),(0,M.jsx)(A._,{tooltip:C||(C=(0,M.jsxs)("span",{children:["Specify the time zone used in the database session, e.g. ",(0,M.jsx)("code",{children:"Europe/Berlin"})," or",(0,M.jsx)("code",{children:"+02:00"}),". This is necessary, if the timezone of the database (or the host of the database) is set to something other than UTC. The value is set in the session with",(0,M.jsx)("code",{children:"SET time_zone='...'"}),". If you leave this field empty, the timezone is not updated. You can find more information in the MySQL documentation."]})),label:"Session timezone",labelWidth:20,children:(0,M.jsx)(v.I,{width:35,value:s.timezone||"",onChange:(0,S._R)(e,"timezone"),placeholder:"(default)"})}),(0,M.jsxs)(I.Z,{children:[(0,M.jsx)(A._,{labelWidth:20,htmlFor:"tlsAuth",label:"TLS Client Auth",children:(0,M.jsx)(L.x,{id:"tlsAuth",onChange:n("tlsAuth"),value:s.tlsAuth||!1})}),(0,M.jsx)(A._,{labelWidth:20,tooltip:"Needed for verifing self-signed TLS Certs",htmlFor:"tlsCaCert",label:"With CA Cert",children:(0,M.jsx)(L.x,{id:"tlsCaCert",onChange:n("tlsAuthWithCACert"),value:s.tlsAuthWithCACert||!1})})]}),(0,M.jsx)(A._,{labelWidth:20,htmlFor:"skipTLSVerify",label:"Skip TLS Verify",children:(0,M.jsx)(L.x,{id:"skipTLSVerify",onChange:n("tlsSkipVerify"),value:s.tlsSkipVerify||!1})})]}),s.tlsAuth||s.tlsAuthWithCACert?(0,M.jsx)(x.C,{label:"TLS/SSL Auth Details",children:(0,M.jsx)(_.d,{showCACert:s.tlsAuthWithCACert,showKeyPair:s.tlsAuth,editorProps:e,labelWidth:25})}):null,(0,M.jsx)(D.K,{labelWidth:r,jsonData:s,onPropertyChanged:(t,a)=>{(0,S.tp)(e,t,a)}}),(0,M.jsx)(x.C,{label:"MySQL details",children:(0,M.jsx)(A._,{tooltip:T||(T=(0,M.jsxs)("span",{children:["A lower limit for the auto group by time interval. Recommended to be set to write frequency, for example",(0,M.jsx)("code",{children:"1m"})," if your data is written every minute."]})),labelWidth:20,label:"Min time interval",children:(0,M.jsx)(v.I,{placeholder:"1m",value:s.timeInterval||"",onChange:(0,S._R)(e,"timeInterval")})})}),E||(E=(0,M.jsxs)(j.b,{title:"User Permission",severity:"info",children:["The database user should only be granted SELECT permissions on the specified database & tables you want to query. Grafana does not validate that queries are safe so queries can contain any SQL statement. For example, statements like ",(0,M.jsx)("code",{children:"USE otherdb;"})," and ",(0,M.jsx)("code",{children:"DROP TABLE user;"})," would be executed. To protect against this we ",(0,M.jsx)("strong",{children:"Highly"})," recommend you create a specific MySQL user with restricted permissions. Checkout the"," ",(0,M.jsx)(w.r,{rel:"noreferrer",target:"_blank",href:"http://docs.grafana.org/features/datasources/mysql/",children:"MySQL Data Source Docs"}),"for more information."]}))]})}))},20770:()=>{},58228:()=>{}}]);
//# sourceMappingURL=mysqlPlugin.fcde7a64678f74e07a21.js.map